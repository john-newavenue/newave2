<% provide(:title, "Edit Featured Work" ) %>

<% content_for :main do %>

  <h1>Edit Featured Work</h1>

  <%= semantic_form_for @album, :as => 'album', :url => featured_architect_work_path(:id => @profile.id), :html => { 'data-album-id' => @album.id, :id => "edit-album" } do |f| %>

     <%= f.inputs do %>

      <%= link_to "Upload Images", featured_architect_new_images_path(@profile, :redirect_uri => request.path), :class => "button small light-blue" %>

      <hr>

          <ul class="large-block-grid-3 small-block-grid-2 sortable-album-items" style="float: left; padding: 1em;">
          <%= f.semantic_fields_for :images do |item| %>
            <li class="item item-<%= item.object.id %>">
              <div class="tile light">
                <div class="draggable-handle vertical">Drag to Move</div>
                <div class="center-text"><%= image_tag item.object.attachment(:medium_square), :style => "width: 75%;" %></div>
                <ul>
                  <%= item.input :title, :label => false, :placeholder => "Title" %>
                  <%= item.input :description, :as => :text, :input_html => { :rows => 2 }, :label => false, :placeholder => "Description"  %>
                  <%= item.input :tag_list, :label => "Tags, comma-separated", :input_html => { :rows => 2, :class => "taggable tagit", :value => item.object.tag_list } %>
                  <label for="mark_for_deletion">
                    <input type="checkbox"
                      name="album[images_attributes][<%= item.index %>][mark_for_deletion]"
                      id="album[images_attributes][<%= item.index %>][mark_for_deletion]"
                    > Mark for Deletion
                  </label>
                  <%= item.input :position, :as => :hidden, :class => "item-position-input" %>
                </ul>

              </div>
            </li>
          <% end %>
          </ul>

      <% if false %>

        <%= f.semantic_fields_for :images do |image| %>
          <%= render :partial => 'frontend/albums/album_items/add_image_fields', :f => image %>
        <% end %>

        <%= link_to_add_association 'Add', f, :images, :partial => 'frontend/albums/album_items/add_image_fields', :class => 'button small light-blue' %>

      <% end %>

      <hr>

      <%= f.action :submit, :as => :button, :label => 'Update', :class => "success button" %>
      <%= link_to "Cancel and go back", featured_architect_with_slug_path(@profile.user.slug) %>

    <% end %>

  <% end %>

<% if false %>

<script language="JavaScript">
  $(document).ready(function () {
    $('#edit-album .add_fields')
      .data('association-insertion-method', 'before')
      .data('association-insertion-node', 'this')
  })
</script>

<% end %>



<script>
$(document).ready( function () {
  $('.formtastic.album#edit_album')
    .on('ajax:before', function() {
      if (event.srcElement == $("#edit_album")[0]) {
        c = $('#album_container')
        c.hide().html('<h3>Saving changes...</h3>').fadeIn()
      }
  })

  $('.sortable-album-items').sortable({
    placeholder: "ui-state-highlight",
    forcePlaceholderSize: true,
    handle: ".draggable-handle",
    containment: ".sortable-album-items",
    stop: function() {
      $('.sortable-album-items input[id^="album_images_attributes_"][id$="_position"] ').each( function(index, elem) {
        $(elem).attr('value',index)
      })
    }
  })

  $('.taggable').tagit({
    caseSensitive: false,
    placeholderText : 'Type new tag'
  });

});
</script>



<% end %>

